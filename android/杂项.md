# 杂项

## 写数据库优化
批量写入比单次写入效率高，因为数据库交易的问题

## 通过增加索引加快数据库查询，但是会减慢插入和删除

## Logcat数据丢失
    连续快速logcat，有些数据丢失，问题不明，待查

## 内存池
    1. 减少内存分配和释放，减少gc次数
    2. 防止内存碎片化，增加内存的使用率     


## RxJava的坑
    1. 如果不设定默认的onError, 并且Subcribe的时候也不指定onError，则会出现未处理异常而崩溃
    2. 在onAccept中，如果出现异常也会触发OnError， 在onError中出现异常会调用默认的onError    

## 使用淘宝Maven镜像
    maven { url "http://maven.aliyun.com/nexus/content/groups/public/" }      
  
## 一次痛苦的排错过程
    现象在release版本上偶现，但是在测试版本上无法出现。排除所有代码的可能性，后来偶然发现打包的代码不是最新的。
    教训： 
    1. 复现问题一定要用目标版本
    2. 不要总是怀疑代码的问题

## 利用view包装非view对象
    重载addView系列方法，然后将从view中提取数据创建真正的view对象，然后添加
    参考在TabLayout中增加TabItem
    
## clipPadding妙用
    对CardView等边缘有特效的场景，如果不设置该属性，边缘效果将被切掉

## 圆角对话框
    View的背景设置成圆角以后没有效果，需要把window的background设置成透明

## 文本颜色混排
        public static CharSequence buildSpannableText(String[] strs, int[] colors) {
            int start = 0;
            SpannableStringBuilder builder = new SpannableStringBuilder();
            for (int i = 0, len = strs.length; i < len; i++) {
                builder.append(strs[i]);
                builder.setSpan(new ForegroundColorSpan(colors[i]), start, builder.length(), Spanned.SPAN_INCLUSIVE_EXCLUSIVE);
                start = builder.length();
            }
            return builder;
        }

## 一种校验Intent有效性的方法
    private static final Map<String, Integer> sTokenMap = new HashMap<>();
    private static final int MAGIC_NUM = 0x34567890;

    public static String createToken(String msg) {
        String strKey = System.currentTimeMillis() + "";
        int hashCode = msg.hashCode();
        sTokenMap.put(strKey, hashCode + MAGIC_NUM);
        return strKey;
    }

    public static Intent createIntent(Context context, int cmd, String param) {
        Intent intent = new Intent(context, MsgCopyReceiver.class)
                    .putExtra("msg_info", createToken(param));

        return intent;
    }

    接收到通知后， 读取token然后用token去取hash值，然后对hash值进行校验
    String token = intent.getStringExtra("msg_info");
    Integer hashCode = sTokenMap.get(token);
    sTokenMap.remove(token);
    if (hashCode == null || hashCode - MAGIC_NUM != param.hashCode()) {
        return;
    }


# ListView中包含checkbox的问题
    如果不做特殊处理， list 的选中和 checkbox的选中状态冲突。 
    非选中item的checkbox 可以被选中

    解决方法：设置item的clickable是false， 这样checkbox就不接收点击事件。只做显示用


